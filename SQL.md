# Подготовка к собеседованию по SQL
## Оглавление
[Go Back](#оглавление)
## Ключи -- todo
* Уникальный
    * Однозначно идентифицирует одну строку в таблице
    * Допустимо множество уникальных ключей в одной таблице
    * Могут быть допустимы NULL-значения
* Внешний ключ
    * Внешний ключ поддерживает ссылочную целостность, обеспечивая связь между данными в двух таблицах
    * Внешний ключ в дочерней таблице ссылается на первичный или уникальный ключ в родительской таблице
    * Ограничение внешнего ключа предотвращает действия, которые разрушают связи между дочерней и родительской таблицами
* Первичный ключ
    * Первичный ключ — столбец или набор столбцов, которые однозначно идентифицируют каждую строку в таблице
    * Однозначно идентифицирует одну строку в таблице
    * Нулевые (Null) значения не допускаются

## Номарлизация -- todo
Что такое нормализация и каковы ее преимущества
Объясните различные типы нормализации.
Что вы подразумеваете под денормализацией

## Индексы -- todo
Опишите различные типы индексов
В чем разница между кластеризованным и некластеризованным индексами в SQL

## Подзапросы
* Это SELECT-запрос, вложенный в другой запрос или подзапрос
* Типы
    * Скалярные - возвращают единственное значение
    * Табличные - возвращают множество значений
* Коррелированный подзапрос
    * Ссылается на значения столбцов внешнего запроса
    * Коррелированный подзапрос выполняется для каждой строки основного запроса
    * В момент выполнения подзапроса значения столбцов внешнего запроса являются константами
``` SQL
SELECT *
  FROM product_price pp
 WHERE pp.price = (SELECT min(ppm.price)
                     FROM product_price ppm
                    WHERE ppm.product_id = pp.product_id)
 ORDER BY pp.product_id, pp.price, pp.store_id
```
## Функции
### Функция vs Хранимая процедура
|Функции|Хранимые процедуры|
|-------|------------------|
|Функция имеет возвращаемый тип и возвращает значение|Хранимая процедура не имеет возвращаемого типа, но имеет выходные аргументы|
|Использование DML (insert, update, delete) запросов внутри функции невозможно. В функциях разрешены только SELECT-запросы|Использование DML-запросов (insert, update, delete) возможно в хранимой процедуре|
|Функция не имеет выходных аргументов|Хранимая процедура имеет и входные, и выходные аргументы|
|Вызов хранимой процедуры из функции невозможен|Использование или же управление транзакциями возможно в хранимой процедуре|
|Вызов функции внутри SELECT запросов возможен|Вызов хранимой процедуры из SELECT запросов невозможно|
### Оконные функции
* Это функция, которая работает с выделенным набором строк (окном, партицией) и выполняет вычисление для этого набора строк в отдельном столбце
* При использовании оконных функций количество строк в запросе не уменьшается по сравнении с исходной таблицей
    * В отличие от агрегации с группировкой
* Классы оконных функций
    * Агрегирующие (Aggregate)
   ``` SQL
   select name, subject, grade,
   sum(grade) over (partition by name) as sum_grade,
   from student_grades;
   ```
    * Ранжирующие (Ranking)
        * В ранжирующих функция под ключевым словом OVER обязательным идет указание условия ORDER BY, по которому будет происходить сортировка ранжирования
        * Для SQL пустые NULL значения будут определяться одинаковым рангом
   ``` SQL
   select name, subject, grade,
   row_number() over (partition by name order by grade desc),
   from student_grades;
   ```
    * Функции смещения (Value)
        * Это функции, которые позволяют перемещаясь по выделенной партиции таблицы обращаться к предыдущему значению строки или крайним значениям строк в партиции
   ``` SQL
   select name, quartal, subject, grade, 
   lag(grade) over (order by quartal) as previous_grade,
   from grades_quartal
   ```
![1](https://habrastorage.org/r/w1560/getpro/habr/upload_files/dbc/8ad/cb9/dbc8adcb9ffeaddfca54a01cd101e755.png)
## Общие вопросы -- todo
В чем разница между операторами DELETE и TRUNCATE?
В чем разница между предложениями HAVING и WHERE
В чем разница между типом данных CHAR и VARCHAR в SQL?
подстановочные знаки


3. Из каких подмножеств состоит SQL
4. Какие существуют типы СУБД
5. 
6. то такое ограничения (Constraints)

16.   Что такое свойство ACID в базе данных?
17.   Что такое транзакции и зачем они нужны

21.   Что такое выражение GROUP BY
22.   Что такое обобщенное табличное выражение (CTE)
23.   Что такое оконная функция и как она используется?
26.   представление SQL
27.   DML, DDL ect
28.   INSERT INTO SELECT
29.    Объясните функцию COALESCE в SQL

аналитические функции, подзапросы, хранимые процедуры, оптимизация производительности

## Joinы 
Тут инфы чуть больше чем в обычном Sql, так как spark рулит
* Self-join в SQL – это тип операции соединения, при которой таблица объединяется сама с собой
* Виды Join
  * Left (Left Outer) - оставляет все из левой таблицы, добавляет туда то, что нашел в правой. Несцепленные строки из левой заполняет null в колонках правой
  * Right (Right Outer) - аналог Left, но работает в другую сторону
  * Inner - оставляет то, что сцепилось из левой и правой таблицы
  * Full (Full Outer) - сцепляет все что можно слева и спава, остальное в null, все как мы привыкли, в итоге получим все
  * Cross - все на все, умножаем поля слева на поля справа (с точки зрения результирующего количества полей)
  * Semi (Left/Right) - оставляет только то из левой таблицы, что нашлось в правой
  * Anti (Left/Right) - оставляет только то из левой таблицы, что **НЕ** нашлось в правой
* Механизмы Join
  * Broadcast Hash Join
    * Одна таблица транслируется всем исполнителям, для каждого из которых строится хэш таблица
    * Далее они начинают соединяться без перетасовки
    * Требует много памяти
  * Shuffle Hash Join
    * Две таблицы выравниваются по схеме партиционирования (либо перемешиваются до похожести)
    * Далее базовый Hash Join (хэш таблица строится, начиная от меньшей по размеру)
    * Меньшее требование к памяти нежели у Broadcast Hash Join (из-за того, что таблица над меньшим объемом данных)
  * Sort Merge Join
    * Shuffle на минималках, для тех, кому жалко ресурсы
  * Cartesian Join - Декартово соединение
    * Используется исключительно для выполнения перекрестного (Cross) соединения между двумя наборами входных данных
  * Broadcast Nested Loop Join
    * Входной набор транслируется на всех
    * А дальше целиком
    * Лучше такое не делать, конечно  
### Всякие СУБД под SQL
#### Greenplum
* Надстройка над PostgresSql для работы с BigData
#### Casandra
* Это нереляционная отказоустойчивая распределенная СУБД, рассчитанная на создание высокомасштабируемых и надёжных хранилищ огромных массивов данных, представленных в виде хэша
#### ClickHouse
* Cтолбцовая система управления базами данных (СУБД) для онлайн-обработки аналитических запросов (OLAP)
## Источники
* https://habr.com/ru/articles/664000/
* https://proglib.io/p/funkcii-i-hranimye-procedury-v-sql-zachem-nuzhny-i-kak-primenyat-v-realnyh-primerah-2022-10-07
